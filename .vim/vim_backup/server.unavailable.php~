<?php
/**
 * DBコネクトできなかった際の画面.
 *
 * @author saito_kazuhisa_gn
 */
// 携帯のキャリア判定用のクラスを読み込み
if (!class_exists('lib3gk')) {
    require_once(VENDORS . 'ecw' . DS . 'lib3gk.php');
}
$lib3gk = new Lib3gk();
if ($lib3gk->is_android() || $lib3gk->is_iphone()) {    // SP用のコンテンツ
    header("Content-type: text/html; charset=UTF-8");
    $encoding = 'UTF-8';

    $document = <<<EOF
<!DOCTYPE html>
<html lang="ja">
<head>
        <meta charset="UTF-8" />
        <title>みんなのバータウン</title>
        <meta name="Description" content="" />
        <meta name="Keywords" content="" />
        <meta name="author" content="" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
        <meta name="format-detection" content="telephone=no" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="black" />
        <link rel="apple-touch-icon" href="http://sp.minnanobar.cyberx.co.jp/img/sm/common/appicon.png" />
        <link rel="apple-touch-icon-precomposed" href="http://sp.minnanobar.cyberx.co.jp/img/sm/common/appicon.png" />
        <link rel="stylesheet" href="http://sp.minnanobar.cyberx.co.jp/css/sm_common.css" media="screen" />
</head>

<body id="content">
<a id="top" name="top"></a>
<div style="text-align:center; background-color:#0051a3;">
    <img src="http://img.common.cyberx.co.jp/minnanobar_prod/img/sm/tmp/rogo.png" width="100%" alt="みんなのバータウン"><br />

    <div style="font-size:1.2em; margin:5px auto;">只今混み合っております</div>

    <div style="text-align:left;">
        <p>現在、アクセス集中により非常に繋がりにくくなっております。</p>
        <p>恐れ入りますが、しばらくたってからもう一度アクセスをお願いします。</p>
    </div>

    <br />

    <div id="spacer" style="height: 200px; width: 10px;"></div>

</div>
</body>

</html>
EOF;
} else {    // FP用のコンテンツ
    $ua = $_SERVER['HTTP_USER_AGENT'];

    // ソフトバンクならUTF8に。それ以外はShift-JIS
    if(ereg("^J-PHONE|^Vodafone|^SoftBank", $ua) !== FALSE) {    // softbankの場合
        header("Content-type: text/html; charset=UTF-8");
        $encoding = 'UTF-8';
    } else {    // auまたはdocomoの場合
        header("Content-type: text/html; charset=Shift_JIS");
        $encoding = 'SJIS-win';
    }

    $document = <<<EOF
<?xml version="1.0" encoding="$encoding" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="ja" xml:lang="ja">
<head>
        <title>みんなのﾊﾞｰﾀｳﾝ</title>
  <meta http-equiv="Content-Type" content="application/xhtml+xml; charset=<?= $encoding; ?>" />
        <meta http-equiv="Content-Style-Type" content="text/css" />
        <meta http-equiv="pragma" content="no-cache" />
        <meta http-equiv="cache-control" content="no-cache" />
        <meta http-equiv="expires" content="-1" />
  <meta name="keywords" content="" />
        <meta name="description" content="" />
</head>

<body style="background-color:#0051A3; color:#ffffff;">

<div style="text-align:center; font-size:x-small;">
    <img src="http://img.common.cyberx.co.jp/minnanobar_prod/img/tmp/rogo.gif" width="240" alt="みんなのﾊﾞｰﾀｳﾝ" /><br />

    <img src="http://img.common.cyberx.co.jp/minnanobar_prod/img/dot0.gif" width="1" height="5" /><br />

    <br />

    <span style="font-size:medium;">只今混み合っております</span><br />

    <br />

    <div style="text-align:left;">
        現在、ｱｸｾｽ集中により非常に繋がりにくくなっております。
        <br />
        恐れ入りますが、しばらくたってからもう一度ｱｸｾｽをお願いします。
    </div>

</div>

</body>
</html>
EOF;
}
header('HTTP/1.0 503 Service Unavailable');
echo mb_convert_encoding($document, $encoding);

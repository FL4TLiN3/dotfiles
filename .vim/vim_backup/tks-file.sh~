#!/bin/bash

# 簡単な使い方：
#   FP_ROOT と SP_ROOT を本番か STG かで変更する。
#   DST をアップしたいディレクトリに変更する。
#   ./tks-file.sh {FILE_PATH} を実行する。

# TODO FP か SP を片方だけ流せるようにする。
# TODO AZ の A か B か片方だけ流せるようにする。
# TODO ホストの管理を外部ファイルに分ける。
# TODO 上の3つの TODO やるなら別に作った方がいい。

################################################################################
# settings.
################################################################################

KEY=~/.ssh/id_rsa.deploy
# Ubuntu
USER_U=www-data
# Amazon Linux
USER_A=apache

OPT="-p -i $KEY"

#FP_ROOT=/var/www/minnanobar_stg
#SP_ROOT=/var/www/sp_minnanobar_stg
FP_ROOT=/var/www/minnanobar
SP_ROOT=/var/www/sp_minnanobar

#DST=app/config
#DST=app/config/const/event/making
#DST=app/config/inc
#DST=app/controllers
#DST=app/controllers/sm
#DST=app/models
#DST=app/vendors
#DST=app/views/ev_forest
#DST=app/views/ev_forest_collectionsheet
#DST=app/views/ev_south_island_collectionsheet
#DST=app/views/event_inside_ranking/ev_south_island
#DST=app/views/sm/sm_event_teaser/sm_ev_south_island
#DST=app/views/sm/sm_events/sm_ev_forest
#DST=app/views/sm/sm_events/sm_ev_forest_collectionsheet
#DST=app/views/sm/sm_events/sm_ev_south_island_team
#DST=app/vendors
#DST=app/webroot
#DST=batch
#DST=sql

DST=app/controllers

FP_DST="$FP_ROOT/$DST"
SP_DST="$SP_ROOT/$DST"

########################################
# Check variable and Usage.
FILE="$1"
if [ ! -f "$FILE" ]; then
    echo "1 ファイルしか指定できません。ディレクトリやシンボリックリンクは無理です。非力。"
    exit 1
fi

echo "'$FILE' ファイルが以下のディレクトリに反映されます。OK ？"
echo "  FP: $FP_DST"
echo "  SP: $SP_DST"
select y_n in Yes No; do
    echo "$y_n"
    if [ "$y_n" == "Yes" ]; then
        break
    elif [ "$y_n" == "No" ]; then
        echo "終了します。"
        exit
    else
        echo "1 か 2 だけですよ。嘘じゃないよ。"
    fi
done

########################################
# FM01
h=fm01.minnanobar.quunapp.com
echo $h
#scp $OPT "$FILE" $USER_U@$h:"$FP_DST"/.
#scp $OPT "$FILE" $USER_U@$h:"$SP_DST"/.


########################################
# FP

# FM03
#fm03.minnanobar.quunapp.com
#175.41.253.144
#54.248.88.28
#54.248.88.29
#54.248.88.31
#54.248.88.126
#54.248.88.129
#54.248.88.134
#54.248.88.135
#54.248.88.136
#54.248.88.137
#54.248.89.238
#54.248.89.241
#54.248.89.243
#54.248.89.245
#54.248.105.239
#54.248.123.83
FP_HOST=(
fm03.minnanobar.quunapp.com
175.41.253.144
54.248.88.28
54.248.88.29
54.248.88.31
54.248.88.126
54.248.88.129
54.248.88.134
54.248.88.135
54.248.88.136
54.248.88.137
)

for h in ${FP_HOST[@]}; do
    echo FP: $h
    scp $OPT "$FILE" $USER_A@$h:"$FP_DST"/.
done

########################################
# SP

SP_HOST=(
54.248.88.25
54.248.88.34
54.248.88.36
54.248.88.37
54.248.88.131
54.248.88.133
54.248.88.138
54.248.88.139
)

for h in ${SP_HOST[@]}; do
    echo SP: $h
    scp $OPT "$FILE" $USER_A@$h:"$SP_DST"/.
done

